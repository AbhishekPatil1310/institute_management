<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        nav a {
            margin-right: 10px;
            text-decoration: none;
            font-weight: bold;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 6px 8px;
            text-align: left;
            vertical-align: top;
        }

        th {
            background-color: #f2f2f2;
        }

        .sub-table {
            width: 100%;
            border-collapse: collapse;
        }

        .sub-table td {
            border: none;
            padding: 3px 0;
        }

        .amount {
            text-align: right;
            white-space: nowrap;
        }
    </style>
</head>
<body>

<h2>Admin Dashboard</h2>

<nav>
    <a href="/admin/daily-report">Daily Report</a> |
    <a href="/admin/batches">Manage Batches</a> |
    <a href="/admin/payment-sources">Payment Sources</a> |
    <a href="/admin/batch-payment-sources">Batch Payment Settings</a> |
    <a href="/change-password">Change Password</a> |
    <a href="/logout">Logout</a>
</nav>

<hr>

<h3>Overall Summary</h3>
<p><strong>Total Collection:</strong> ₹{{ total_collection }}</p>
<p><strong>Total Pending Fees:</strong> ₹{{ total_pending }}</p>

<hr>

<h3>Batch-wise Summary (with Payment Breakdown)</h3>

<table>
    <tr>
        <th>Batch Code</th>
        <th>Course</th>
        <th>Students</th>
        <th>Total Collected</th>
        <th>Total Pending</th>
        <th>Payment Received (by Source)</th>
    </tr>

    {% for b in batch_stats %}
    <tr>
        <td>{{ b.batch_code }}</td>
        <td>{{ b.course_name }}</td>
        <td>{{ b.student_count or 0 }}</td>
        <td class="amount">₹{{ b.paid_total or 0 }}</td>
        <td class="amount">₹{{ b.pending_total or 0 }}</td>
        <td>
            {% set breakdown = payment_breakdown_map.get(b.batch_id, []) %}
            {% if breakdown %}
                <table class="sub-table">
                    {% for row in breakdown %}
                    <tr>
                        <td>{{ row.method }}</td>
                        <td class="amount">₹{{ row.amount }}</td>
                    </tr>
                    {% endfor %}
                </table>
            {% else %}
                <em>No payments</em>
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>

</body>
</html>
